<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hardness Min-Max Finder</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f4f6f8; font-family: Arial, sans-serif; }
    .container { max-width: 750px; margin-top: 50px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    textarea { height: 150px; resize: vertical; }
    .result-box { background: #e9ecef; padding: 15px; border-radius: 5px; margin-top: 20px; font-weight: bold; white-space: pre-line; }
    .line-box { display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px; }
    .line-text { flex-grow: 1; margin-right: 10px; }
    .copied-msg { color: green; font-weight: bold; margin-right: 15px; display: none; }
    .btn-sm { padding: 0.35rem 0.7rem; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4 text-center">Hardness Min-Max Finder</h2>
    
    <div class="mb-3">
      <label for="readings" class="form-label">Enter hardness readings:</label>
      <textarea class="form-control" id="readings" placeholder="30, 30.2, 30.4, 31.5"></textarea>
    </div>
    
    <div class="mb-3 row">
      <div class="col-md-3">
        <label for="unitType" class="form-label">Hardness Unit:</label>
        <select id="unitType" class="form-select">
          <option value="HRC" selected>HRC</option>
          <option value="HRB">HRB</option>
          <option value="HRA">HRA</option>
          <option value="HV">HV</option>
          <option value="HB">HB</option>
        </select>
      </div>
      <div class="col-md-3">
        <label for="correction" class="form-label">Correction factor:</label>
        <input type="number" step="0.1" class="form-control" id="correction" placeholder="e.g. 0.5">
      </div>
      <div class="col-md-6">
        <label for="correctionDesc" class="form-label">Correction description:</label>
        <input type="text" class="form-control" id="correctionDesc" placeholder="e.g. 2">
      </div>
    </div>
    
    <div class="d-flex gap-2">
      <button class="btn btn-primary flex-grow-1" onclick="calculateMinMax()">Calculate</button>
      <button class="btn btn-secondary flex-grow-1" onclick="clearAll()">Clear</button>
    </div>
    
    <div id="result" class="result-box mt-3" style="display:none;"></div>
  </div>

  <script>
    function calculateMinMax() {
      const readingsInput = document.getElementById('readings').value;
      const correctionInput = document.getElementById('correction').value;
      const correction = parseFloat(correctionInput) || 0;
      const correctionDesc = document.getElementById('correctionDesc').value.trim();
      const unit = document.getElementById('unitType').value || 'HRC';

      if (!readingsInput.trim()) return;

      const rawTokens = readingsInput
        .split('\n')
        .flatMap(line => line.split(','))
        .map(item => item.trim().replace(/[^\d\.\-]/g, ''))
        .filter(item => item !== "");

      if (rawTokens.length === 0) return;

      const numReadings = rawTokens.map(val => parseFloat(val));
      const minValNum = Math.min(...numReadings);
      const maxValNum = Math.max(...numReadings);

      // Extract the exact strings from input
      const minValStr = rawTokens[numReadings.indexOf(minValNum)];
      const maxValStr = rawTokens[numReadings.indexOf(maxValNum)];

      // Calculate results without forcing .toFixed(2)
      // This preserves natural decimals (e.g., 1.2 + 0 = 1.2)
      const minCorrected = Number((minValNum + correction).toPrecision(12)) / 1;
      const maxCorrected = Number((maxValNum + correction).toPrecision(12)) / 1;

      let line1 = `${minValStr} / ${maxValStr}`;
      
      if (correction !== 0) {
        line1 += ` + ${correction} = ${minCorrected} / ${maxCorrected} ${unit}`;
      } else {
        line1 += ` = ${minCorrected} / ${maxCorrected} ${unit}`;
      }

      let line2 = "";
      if (correction !== 0 && correctionDesc) {
        line2 = `Add ${correction}" ${unit} For ${correctionDesc}" Dia`;
      }

      const resultDiv = document.getElementById('result');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = `
        <div class="line-box">
            <div class="line-text">${line1}</div>
            <span class="copied-msg" id="copied1">Copied</span>
            <button class="btn btn-sm btn-outline-success" onclick='copyText(\`${line1}\`,"copied1")'>Copy</button>
        </div>
        ${line2 ? `
        <div class="line-box">
            <div class="line-text">${line2}</div>
            <span class="copied-msg" id="copied2">Copied</span>
            <button class="btn btn-sm btn-outline-success" onclick='copyText(\`${line2}\`,"copied2")'>Copy</button>
        </div>` : ""}
      `;
    }

    function copyText(text, msgId) {
      navigator.clipboard.writeText(text).then(() => {
        const msg = document.getElementById(msgId);
        msg.style.display = 'inline';
        setTimeout(() => { msg.style.display = 'none'; }, 1500);
      });
    }

    function clearAll() {
      document.getElementById('readings').value = '';
      document.getElementById('correction').value = '';
      document.getElementById('correctionDesc').value = '';
      document.getElementById('result').style.display = 'none';
    }
  </script>
</body>
</html>
